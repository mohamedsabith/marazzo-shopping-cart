{{>user-header token=token totalAmt=totalAmt}}
{{>user-navbar countCart=countCart}}
<div class="breadcrumb">
    <div class="container-fluid">
        <div class="breadcrumb-inner">
            <ul class="list-inline list-unstyled">
                <li><a href="/">Home</a></li>
                <li class='active'>Shopping Cart</li>
            </ul>
        </div>
    </div>
</div>
{{#if empty}}
<div class="container mt-100">
				 <div class="row">
				 
					<div class="col-md-12">
					
							<div class="card">
						<div class="card-header">
						</div>
						<div class="card-body cart">
								<div class="col-sm-12 empty-cart-cls text-center">
									<img src="https://i.imgur.com/dCdflKN.png" width="130" height="130" class="img-fluid mb-4 mr-3">
									<h3><strong style="font-family: 'Calibri', sans-serif !important;">Your Cart is Empty</strong></h3>
									<h4 style="font-family: 'Calibri', sans-serif !important;">Add something to make me happy :)</h4>
									<a href="/" class="btn btn-primary cart-btn-transform m-3" data-abc="true" style="font-family: 'Calibri', sans-serif !important;">continue shopping</a>
									
								
								</div>
						</div>
				</div>					
</div>
</div>				
</div>
{{else}}
<div class="body-content outer-top-xs" id="qty">
    <div class="container">
        <div class="row ">
            <div class="shopping-cart">
                <div class="shopping-cart-table">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th class="cart-description item">Image</th>
                                    <th class="cart-product-name item">Product Name</th>
                                    <th class="cart-qty item">Quantity</th>
                                    <th class="cart-sub-total item">Subtotal</th>
                                    <th class="cart-total last-item">Grandtotal</th>
                                     <th class="cart-romove item">Remove</th>
                                </tr>
                            </thead>
                             <tbody>
                                 {{#each cart.products}}
                                <tr>
                                    <td class="cart-image">
                                        <a class="entry-thumbnail" href="/viewProduct/{{this.productId}}">
                                            <img src="/products/{{this.image}}" alt="cart image">
                                        </a>
                                    </td>
                                    <td class="cart-product-name-info">
                                        <h4 class='cart-product-description'><a href="">{{this.name}}</a></h4>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="rating rateit-small"></div>
                                            </div>
                                            <div class="col-sm-12">
                                                <div class="reviews">
                                                    (06 Reviews)
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="cart-product-quantity">
                                        <div class="quant-input">
                                             <div class="arrows">
				                    <div class="arrow plus gradient"><span class="ir"><i class="icon fa fa-sort-asc" onclick="changeQuantity('{{../cart._id}}','{{this.productId}}','{{this.quantity}}',1)"></i></span></div>
				                    <div class="arrow minus gradient"><span class="ir"><i class="icon fa fa-sort-desc" onclick="changeQuantity('{{../cart._id}}','{{this.productId}}','{{this.quantity}}',-1)"></i></span></div>
				                           </div>
                                             <input type="text" min="1" value="{{this.quantity}}">
                                        </div>
                                    </td>
                                    <td class="cart-product-sub-total"><span class="cart-sub-total-price">${{this.price}}</span>
                                    </td>
                                    <td class="cart-product-grand-total"><span
                                            class="cart-grand-total-price">${{this.total}}</span></td>
                                  <td class="romove-item"><a onclick="cartDelete('{{../cart._id}}','{{this.productId}}')" title="cancel" class="icon"><i class="fa fa-trash-o"></i></a></td>
                                </tr>
                                {{/each}}
                                </tbody>

                                <tfoot>
                                    <tr>
                                        <td colspan="7">
                                            <div class="shopping-cart-btn">
                                                <span class="">
                                                    <a href="/" class="btn btn-upper btn-primary outer-left-xs">Continue
                                                        Shopping</a>
                                                    <a class="btn btn-upper btn-primary pull-right outer-right-xs">Update Cart</a>
                                                </span>
                                            </div>
                                        </td>
                                    </tr>
                                </tfoot>
                        </table>
                    </div>
                </div>
                <div class="col-md-4 col-sm-12 estimate-ship-tax">
                    <table class="table">
                        <thead>
                            <tr>                     
                            </tr>
                        </thead>
                    </table>
                </div>
                <div class="col-md-4 col-sm-12 estimate-ship-tax">
                    <table class="table">
                        <thead>
                        </thead>
                        <tbody>
                            <tr>
                            </tr>
                        </tbody>
                    </table>
                </div>
                {{#if totalAmt.Total.total}}
                <div class="col-md-4 col-sm-12 cart-shopping-total">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>
                                    <div class="cart-sub-total">
                                        Price ({{countCart}} items)<span class="inner-left-md">$ {{totalAmt.Total.total}}</span>
                                    </div>
                                    <div class="cart-sub-total">
                                        Discount Price<span class="inner-left-md" style="color: green;">$ -{{cart.discountPrice}}</span>
                                    </div>
                                    <div class="cart-sub-total">
                                        Delivery charges<span class="inner-left-md">$ {{cart.shippingcost}}</span>
                                    </div>
                                    <div class="cart-grand-total">
                                        Total Amount<span class="inner-left-md">$ {{totalAmt.totalAmount}}</span>
                                    </div>
                                </th>
                            </tr>
                        </thead><!-- /thead -->
                        <tbody>
                            <tr>
                                <td>
                                    <div class="cart-checkout-btn pull-right">
                                        <button type="submit" class="btn btn-primary checkout-btn" onclick="window.location.href='/billing' ">PROCCED TO CHEKOUT</button>
                                        <span class="">Checkout with multiples address!</span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                {{/if}}
            </div>
        </div>
    </div>
</div>
{{/if}}
<div class="row our-features-box" style="margin-top: 100px;">
    <div class="container">
        <ul>
            <li>
                <div class="feature-box">
                    <div class="icon-truck"></div>
                    <div class="content-blocks">We ship worldwide</div>
                </div>
            </li>
            <li>
                <div class="feature-box">
                    <div class="icon-support"></div>
                    <div class="content-blocks">call
                        +1 800 789 0000</div>
                </div>
            </li>
            <li>
                <div class="feature-box">
                    <div class="icon-money"></div>
                    <div class="content-blocks">Money Back Guarantee</div>
                </div>
            </li>
            <li>
                <div class="feature-box">
                    <div class="icon-return"></div>
                    <div class="content">30 days return</div>
                </div>
            </li>

        </ul>
    </div>
</div>
{{>user-footer}}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script type="text/javascript">

function changeQuantity(cartId,proId,qty,count){
    $.ajax({
        url:'/change-product-quantity',
        data:{
            cart:cartId,
            product:proId,
            qty:qty,
            count:count
        },
        method:'post',
        success:(response)=>{
        if(response.count){
           $("#qty").load(window.location.href + " #qty" );
        }else if(response.quantity==0){
         
        }else{
         swal("Out of Stock", {
                icon: "error",
            })
        }
     }
    })
}

function cartDelete(cartId,proId){
    swal({
        title: "Are you sure?",
        text: "You want to remove this from your cart",
        icon: "warning",
        buttons: true,
        dangerMode: true,
 }).then((willDelete)=>{
  if(willDelete){
     $.ajax({
        url:'/cartDelete',
        data:{
            cart:cartId,
            product:proId,
        },
        method:'post',
        success:(response)=>{
         location.reload()
       }
        })
 }
      })
}

</script>